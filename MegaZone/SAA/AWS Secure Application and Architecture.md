# AWS SAA

---

## 안전한 애플리케이션 및 아키텍처 설계

### AWS Cloud Trail

- AWS 계정의 거버넌스, 규정 준수, 운영 감사, 위험 감사를 지원하는 서비스
- AWS 인프라에서 계정 활동과 관련된 작업을 기록하고 지속적으로 모니터링
- 감시 목적으로 올바른 정보가 제공되도록 AWS에서 제공되는 서비스
- CloudTrail 로그와 CloudWatch 함께 사용
- 특정 API를 모니터링하는 CloudWatch 경보를 생성하여 해당 API 동작 확인

### Amazon VPC(Virtual Private Cloud)

- 사용자가 정의한 가상 네트워크로 AWS 리소스를 시작할 수 있는 AWS 클라우드에서 논리적으로 격리된 세션
- VPC 공유를 사용하면 여러 AWS 계정에서 EC2 인스턴스, RDS, Redshift 클러스터, Lamdba 함수 등과 같은 애플리케이션 리소스를 공유되는 중앙 관리형 Amazon Virtual Private Cloud 생성
- VPC를 소유한 계정은 AWS Organization의 동일 조직에 속한 다른 계정과 여러 개의 서브넷 공유
- 암시적 라우팅 활용 가능
- PrivateLink, Transit Gateway, VPC 피어링 등의 연결 기능을 통해 VPC를 상호 연결하여 네트워크 토폴로지 단순화
- VPC 소유자는 참여자가 생성한 보안 그룹, 참여자 리소스를 수정하거나 삭제 불가능
- VPC 소유자는 문제 해결 및 감사를 위해 모든 네트워크 인터페이스 및 세부정보 볼 수 있음, 트래픽 모니터링, ENI 수준에서 흐름로그 구독 생성

### Amazon EC2

- 클라우드에서 안전하고 크기 조정 가능한 컴퓨팅 용량 제공

### Amazon CloudWatch

- AWS 리소스를 위한 모니터링 도구

### Amazon S3

- 확장성과 데이터 가용성 및 보안과 성능을 제공하는 객체 스토리지 서비스
- 서버 액세스 로깅은 버킷에 대해 이루어진 요청에 따른 상세 레코드 제공
- 액세스 로그 정보는 보안 및 액세스 감사에 유용
- S3 데이터의 객체 수준 작업에 대한 가시성 제공

---
#### 암호화

- 서버 암호화(SSE-S3) : 관리형 키를 사용하여 각 객체 고유한 키로 암호화
                       주기적으로 바뀌는 마스터 키를 사용하여 키 자체 암호화
                       강력한 블록 암호 256 빝트 고급 암호화 표준(AES-256) 사용
- 서버 암호화(SSE-KMS) : Key Management Service에 저장된 고객 마스터키(CMK)를 사용한 서버 암호화
                        SSE-S3와 유사하지만 추가적 이점과 비용 발생
                        사용된 떄와 사용 주체를 표시하는 감사추적 기능 제공
- 서버 암호화(SSE-C) : 고객 제공 키를 사용하여 사용자는 암호화 키를 관리 Amazon S3는 암호화 및 해독을 관리
                      클라이언트 측 암호화는 S3로 보내기 전에 데이터 암호화

### AWS IAM(Identity and Access Management)

- AWS 리소스에 대한 액세스를 안전하게 제어할 수 이쓴 웹 서비스
- 리소스를 사용하도록 인증 및 권한 부여된 대상을 제어
- 정책을 만들 때는 최소 권한 부여의 표준 보안 조언을 따르거나, 작업 수행에 필요한 최소한의 권한만 부여

---

#### 권장 사항
- AWS 계정 루트 사용자 액세스 키 잠금
- 개별 IAM 사용자 만들기
- 그룹을 사용하여 IAM 사용자에게 권한 할당
- 최소 권한 부여
- 관리형 정책으로 권한 사용 시작
- 인라인 정책 대신 고객 관리형 정책 사용
- 액세스 레벨을 이용한 IAM 권한 검토
- 사용자에 대한 강력한 암호 정책 구성
- MFA 활성화
- EC2 인스턴스에서 실행되는 애플리케이션에 역할 사용
- 역할을 사용하여 권한 위임
- 액세스 키 공유 X
- 자격 증명을 정기적으로 교체
- 불필요한 자격 증명 삭제
- AWS 계정 활동 모니터링

---

#### 정책

- 자격 증명 기반 정책 : 관리형 및 인라인 정책을 IAM 자격 증명에 연결, 자격증명 기반 저액은 자격 증명에 권한 부여
- 리소스 기반 정책 : 인라인 정책을 리소스에 연결 
                    S3 버킷 정책 및 IAM 역할 신뢰 정책
                    정책에 지정된 보안 주체에 권한을 부여, 보안주체는 리소스와 동일한 계정, 다른 계정에 있음
                    관리형 정책 - AWS 관리형 정책, 고객 관리형 정책
                    인라인 정책
- 권한 경계 : 관리형 정책을 IAM 엔터티에 대한 권한 경계로 사용
             자격 증명 기반 정책을 통해 엔터티에 부여할 수 있는 최대 권한 정의, 권한 부여 X
             리소스 기반 정책을 통해 엔터티에 부여할 수 있는 최대 권한 정의 X
- 조직 SCP : AWS Organization 서비스 제어 정책을 사용 조직, 조직단위의 계정 멤버에 대한 최대 권한 정의
             자격 증명 기반 정책, 리소스 기반 정책을 통해 계정 내 엔터티에 부여하는 권한을 제한, 권한 부여 X
- 엑세스 제어 목록 : ACL이 연결된 리소스에 액세스 할 수 있는 다른 계정의 보안 주체를 제어
                    리소스 기반 정책과 비슷
                    Json 정책 문서 구조를 사용하지 않는 유일한 정책
                    교차 계정 권한 정책, 동일 계정 내 엔터티에 권한 부여 X
- 세션 정책 : AWS CLI, AWS API를 사용하여 역할이나 연합된 사용자를 수임할 때 고급 세션 정책 전달
             역할이나 사용자의 자격 증명 기반 정책을 통해 세션에 부여하는 권한 제한
             세션에 대한 권한을 제한 X, 권한 부여 X

### AWS CloudHSM(Hardware Security Module)

- 변조 방지 하드웨어 디바이스 내에서 안전한 키 스토리지와 암호화 작업 제공
- AWS 클라우드 내에서 전용 HSM 인스턴스를 사용함으로써 데이터 보안에 대한 기업, 계약 및 규제 준수 요구사항을 충족
- 데이터 암호화에 사용되는 암호화 키를 사용자만 액세스할 수 있는 방법으로 안전하게 생성,보관 및 관리
- 물리적 및 논리적 변조감지와 대응 메커니즘을 갖추고 있음, 하드웨어의 키 삭제(제로화)가 트리거
- 하드웨어는 물리적 장벽이 침해되는 경우 변조를 감지
- 무작위 로그인 공격으로부터 보호
- 자격증명을 손실한 경우 키 복구 불가능

### AWS ELB - Classic Load Balancer

#### 연결 드레이닝

- CLB가 등록 취소 중이거나 비정상 상태인 인스턴스로의 요청 전송을 중치하려면 연결 드레이닝 사용
- 로드 밸런서가 인스턴스의 등록 취소를 보고하기 전에 연결 유지 할 수 있는 최대 시간 지정
- 최대 제한 시간 1 ~ 3600초 (default 300s)
- 최대 제한 시간 도달하면 로드밸런스는 등록 취소 중인 인스턴스 강종

#### 교차 영역 로드 밸런싱

- CLB에 대한 각각의 로드 밸런서 노드가 활성화된 모든 가용 영역에 있는 등록된 인스터스 간에 요청을 균등하게 분산
- 비활성화된 경우 각각의 로드 밸런서 노드가 해당 가용 영역에만 있는 동록된 인스턴스 간에 요청을 균등하게 분산

#### 고정 세션

- CLB는 로드가 적은 등옥 인스턴스에 각 요청을 독립적으로 라우팅
- 고정세션기능(세션 어피니티)을 사용해 로드 밸런서가 사용자의 세션을 특정 인스턴스에 바인딩
- 세션 중에 사용자로부터 들어오는 모든 요청이 동일한 인스턴스로 전송
- 애플리케이션이 자체 세션 쿠키를 가지고 있지 않은 경우 자체 고정 기간을 지정하여 세션 쿠키를 생성하도록 ELB을 구성

#### 유휴 연결 제한 시간

- 유휴 제한 시간이 경과할 때까지 데이터가 전송되거나 전송 또는 수신 되지 않으면 로드 밸런서는 프론트 엔드 연결 종료

### Site-to-Site VPN

- VPC를 온프레미스 네트워크에 비공개 연결
- VPC와 네트워크 경로 간에 전송되는 데이터는 암호화된 VPN 연결을 통해 라우팅되어 전송 데이터의 기밀성과 무결성 유지
- 인터넷 프로토콜 보안(IPsec) VPN 연결 지원
- IPsec은 데이터 흐름의 각 IP 패킷을 인증하고 암호화함으로써 IP 통신의 보안을 유지하는 프로토콜
- 두 개의 암호화된 IPsec VPN 터널로 구성, 각 터널의 트래픽은 AES128, AES256을 사용하여 암호화
- 반대쪽에 있는 리소스에 연결하기 위한 퍼블릭 IP 주소 필요 X
- 인터넷 트래픽을 라우팅할 수 있음

### AWS Direct Connect 

- 전송중인 트래픽을 암호화 X
- 전송중인 데이터를 암호화하려면 해당 서비스에 대한 전송 암호화 옵션 사용

### AWS DataSync

- 온프레미스 스토리지와 AWS 간에 대량의 데이터를 온라인으로 쉽고 빠르게 이동
- 스크립팅 복사 작업, 스케쥴링 및 전송 모니터링, 데이터 검증, 네트워크 활용률 최적화 등 많은 작업을 제거하거나 자동으로 처리
- 온프레미스 데이터 센터와 AWS Cloud 간의 네트워크 연결 설정 X

### AWS Secrets Manager

- 애플리케이션, 서비스 및 IT 리소스에 액세스하는데 필요한 기밀을 보호
- 전체 수명 주기 동안 데이터베이스 인증 정보, API 키 및 기타 암호를 쉽게 회전, 관리 및 검색

### Amazon Conginto

- 웹 및 모바일 앱에 대한 인증, 권한 부여 및 사용자 관리 제공
- 직접 로그인, Facebook, Amazon, Google, Apple 로그인 가능
- 구성 요소 : 사용자 풀 - 앱 사용자의 가입 및 로그인 옵션 제공
             자격 증명 풀 - 사용자 액세스 권한 부여
- 멀티 팩터 인증(MFA) : 사용자 풀에 추가하여 사용자의 자격 증명 보호
                       사용자 이름 및 암호에만 의존하지 않는 두 번째 인증방법 추가
                       SMS 문자, 일회용 암호(TOTP) 사용
                       위험 기반 모델에서 조정 인증 사용하여 예측 가능
                       사용자 풀의 고급 보안 기능, 손상된 자격 증명 사용을 방지하는 기능 

### Amazon Snowball vs Snowball 엣지

- AWS 기능 구현하기 위해 온보드 스토리지 및 컴퓨팅 파워를 갖춘 디바이스 유형
- Snowball Edge는 로컬 환경과 AWS 클라우드 사이에서 데이터를 전송하는 것 외에 로컬 처리 및 엣지 컴퓨팅 워크로드를 수행
- 인터넷보다 더 빠른 속도로 데이터로 전송
- 스토리지 최적화,컴퓨팅 최적화, GPU 옵션
- Amazon S3에 업로드하고 다운로드
- 50TB, 80TB vs 100TB(83TB 사용 가능)

### Amazon ELB
